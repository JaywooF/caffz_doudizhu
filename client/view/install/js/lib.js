var lib={load:0,detail:function(_path,_msg,_num){var _nums=_num+1;var _details=_msg.split(",");if(_nums>_details.length){$(".alert").html("数据安装成功，请稍等...");setTimeout("location.href='"+_path+"index.php/install/insert'",1e3)}else{$(".alert").html("<ul><li>建立数据表 "+_details[_num]+" ... 成功</li></ul>");setTimeout("lib.detail('"+_path+"','"+_msg+"',"+_nums+")",300)}},step:function(_path){this.load=layer.load(1);$(".button-next").attr("disabled",true);$.getJSON(_path+"index.php/install/create/step",function(data){layer.close(lib.load);if(data.state==1){$(".alert").text("正在显示安装过程...");setTimeout("lib.detail('"+_path+"','"+data.msg+"',0)",1e3)}else{$(".alert").attr("class","alert alert-danger").html(data.msg)}}).fail(function(xhr){layer.close(lib.load);$(".alert").attr("class","alert alert-danger").html(xhr.responseText)})},create:function(){var _dbhost=$("input[name='dbhost']").val().replace(/^\s+|\s+$/g,"");var _dbport=$("input[name='dbport']").val().replace(/^\s+|\s+$/g,"");var _dbuser=$("input[name='dbuser']").val().replace(/^\s+|\s+$/g,"");var _dbpw=$("input[name='dbpw']").val().replace(/^\s+|\s+$/g,"");var _dbname=$("input[name='dbname']").val().replace(/^\s+|\s+$/g,"");var _dbtablepre=$("input[name='dbtablepre']").val().replace(/^\s+|\s+$/g,"");if(/['"&<>\\]/.test(_dbhost)){layer.alert("数据库主机不符合规范！",{icon:7});return false}else if(_dbhost.length<1){layer.alert("数据库主机不能为空！",{icon:7});return false}else if(!/^\d+$/.test(_dbport)){layer.alert("数据库端口不符合规范！",{icon:7});return false}else if(/['"&<>\\]/.test(_dbuser)){layer.alert("数据库用户不符合规范！",{icon:7});return false}else if(_dbuser.length<1){layer.alert("数据库用户不能为空！",{icon:7});return false}else if(/['"&<>\\]/.test(_dbpw)){layer.alert("数据库密码不符合规范！",{icon:7});return false}else if(_dbpw.length<1){layer.alert("数据库密码不能为空！",{icon:7});return false}else if(/[^\x21-\x7e]|['"&<>:*?|\/\\]/.test(_dbname)){layer.alert("数据库名称不符合规范！",{icon:7});return false}else if(_dbname.length<1||_dbname.length>32){layer.alert("数据库名称最短1位、最长32位！",{icon:7});return false}else if(!/^\w+_$/.test(_dbtablepre)){layer.alert("数据表前缀不符合规范！",{icon:7});return false}else if(_dbtablepre.length>16){layer.alert("数据表前缀最长16位！",{icon:7});return false}else{return true}},insert:function(){var _account_name=$("input[name='account_name']").val().replace(/^\s+|\s+$/g,"");var _account_pw=$("input[name='account_pw']").val().replace(/^\s+|\s+$/g,"");var _account_rpw=$("input[name='account_rpw']").val().replace(/^\s+|\s+$/g,"");if(/[^\x21-\x7e]|[&][#]?[a-zA-Z0-9]+[;]/.test(_account_name)){layer.alert("管理员帐号不符合规范！",{icon:7});return false}else if(_account_name.length<6||_account_name.length>24){layer.alert("管理员帐号最短6位、最长24位！",{icon:7});return false}else if(/[^\x21-\x7e]|[&][#]?[a-zA-Z0-9]+[;]/.test(_account_pw)){layer.alert("管理员密码不符合规范！",{icon:7});return false}else if(_account_pw.length<6||_account_pw.length>24){layer.alert("管理员密码最短6位、最长24位！",{icon:7});return false}else if(_account_pw!=_account_rpw){layer.alert("两次输入的密码不一致！",{icon:7});return false}else{return true}}};