var lib={load:0,listen:0,timer:6e3,counter:{self:0,right:0,left:0},chose:function(_this){var _top=$(window).width()>767?"-20px":"-10px";_this.css("top")==_top?_this.css("top",""):_this.css("top",_top)},past:function(_rid,_path,_token){if($(".room-right-fight").is(":hidden")&&$(".room-left-fight").is(":hidden")){$(".room-self-notify .room-clock").css("visibility","hidden");$(".room-rule").fadeIn("slow");setTimeout("$('.room-rule').fadeOut('fast');$('.room-self-notify .room-clock').css('visibility', '')",1e3)}else{this.play(0,_rid,_path,_token)}},filter:function(_last){if($(".room-right-fight").is(":hidden")&&$(".room-left-fight").is(":hidden")){this.chose(_last)}else{var _plan=[],_fight=[];var _prev=$(".room-left-fight").is(":visible")?"left":"right";$(".room-"+_prev+"-fight i").each(function(){_fight.push($(this).attr("class").match(/\d+/))});$(".room-self-plan i").each(function(){_plan.push($(this).attr("class").match(/\d+/))});var _list=this.search(_plan,_fight);if(_list.length>0){_list.forEach(function(t){lib.chose($(".room-self-plan i").eq(t))})}else{$(".room-self-notify .room-clock").css("visibility","hidden");$(".room-weak").fadeIn("slow");setTimeout("$('.room-weak').fadeOut('fast');$('.room-self-notify .room-clock').css('visibility', '')",1e3)}}},search:function(_plan,_fight){var _me=this.mold(_plan,1);var _he=this.mold(_fight,1);var _own=this.mold(_plan,0).join("");var _foe=this.mold(_fight,0).join("");var _type=function(){if(_foe.length<4){return _foe.length<3?_foe.length<2?"single":_foe[0]=="x"?"joker":"double":"same"}else if(_foe[0]==_foe[_foe.length-1]){return"bomb"}else if(/(\d|t|j|q|k|a)\1{3}/.test(_foe)){return"mix"}else if(/(\d|t|j|q|k|a)\1{2}/.test(_foe)){return"fly"}else if(/(\d|t|j|q|k|a)\1{1}/.test(_foe)){return"pair"}return"flow"};var _joker=function(){return _me.length>1&&_me[1]==16?[1,0]:[]};var _bomb=function(){if(/(\d|t|j|q|k|a)\1{3}/.test(_own)){for(var i=_own.length-1;i>2;i--){if(_own[i]==_own[i-3]){return[i,i-1,i-2,i-3]}}}return[]};var _near=function(n){for(var i=_me.length-1;i>=n;i--){if(_me[i]>_he[0]&&_me[i]==_me[i-n]){return n<3?n<2?[i,i-1]:[i,i-1,i-2]:[i,i-1,i-2,i-3]}}return n<3&&_bomb().length>0?_bomb():_joker()};var _map=function(m,e){return m.map(function(t){return _me[t]}).indexOf(e)};var _mix=function(m,h){if(m==1){for(var i=_me.length-1;i>2;i--){if(_me[i]>h&&_me[i]==_me[i-3]){return[i,i-1,i-2,i-3]}}return[]}else if(m==2){if(_me.length>=_he.length&&h.length>0){for(var i=_me.length-1;i>=0;i--){if(_he.length==6){h.indexOf(i)<0&&h.push(i);if(h.length==6){h=_me[h[4]]==16?[]:h;break}}else if(i>0&&_me[i]==_me[i-1]){_map(h,_me[i])<0&&h.push(i,i-1);if(h.length==8){break}}}}return h.length!=_he.length?_bomb().length>0?_bomb():_joker():h}for(var i=0;i<_he.length-3;i++){if(_he[i]==_he[i+3]){return _he[i]}}};var _fly=function(f,a){if(f==1){for(var i=_me.length-1;i>a[1]*3-2;i--){if(_me[i]>a[0]&&_me[i]==_me[i-2]){a[2].push(i,i-1,i-2);for(var n=i-3;n>1;n--){if(a[2].length==a[1]*3){break}_me[n]<15&&_me[n]==_me[n-2]&&_me[n]==_me[a[2][a[2].length-1]]+1&&a[2].push(n,n-1,n-2)}if(a[2].length==a[1]*3){break}a[2]=[]}}return a[2]}else if(f==2){if(a[2]>0&&_me.length>=_he.length&&a[0].length==a[1]*3){for(var i=_me.length-1;i>=0;i--){if(a[2]<2){if(_map(a[0].slice(0,a[1]*3),_me[i])<0&&_me[i]!=_me[a[0][a[0].length-3]]){if(_me[a[0][a[0].length-1]]<15&&_me[a[0][a[0].length-1]]==_me[a[0][a[0].length-2]]&&_me[a[0][a[0].length-1]]==_me[a[0][a[0].length-3]]+1){_me[i]!=_me[a[0][a[0].length-1]]&&a[0].push(i)}else{a[0].push(i)}if(a[0].length==a[1]*4){a[0]=_me[a[0][a[0].length-2]]==16?[]:a[0];break}}}else if(i>0&&_me[i]==_me[i-1]){_map(a[0],_me[i])<0&&a[0].push(i,i-1);if(a[0].length==a[1]*5){break}}}}return a[0].length!=_he.length?_bomb().length>0?_bomb():_joker():a[0]}if(a[0]<1){for(var i=0;i<_he.length-3;i++){if((i+1)%3<1){if(_he[i]!=_he[i+3]-1){return[_he[3],a[1]-1,1]}else if(i==_he.length-4){return _he[_he.length-1]<15?[_he[0],a[1],0]:[_he[0],a[1]-1,1]}}}}else if(_he.length==16&&a[0]==1){return[_he[4],a[1]-1,1]}for(var i=0;i<_he.length-2;i++){if(_he[i]==_he[i+2]){return[_he[i],a[1],a[0]==a[1]?1:2]}}};var _pair=function(p){for(var i=_me.length-1;i>_he.length-2;i--){if(_me[i]>_he[0]&&_me[i]==_me[i-1]){p.push(i,i-1);for(var n=i-2;n>0;n--){if(p.length==_he.length){break}_me[n]<15&&_me[n]==_me[n-1]&&_me[n]==_me[p[p.length-1]]+1&&p.push(n,n-1)}if(p.length==_he.length){break}p=[]}}return p.length!=_he.length?_bomb().length>0?_bomb():_joker():p};var _flow=function(f){for(var i=_me.length-1;i>_he.length-2;i--){if(_me[i]>_he[0]){f.push(i);for(var n=i-1;n>=0;n--){if(f.length==_he.length){break}_me[n]<15&&_me[n]==_me[f[f.length-1]]+1&&f.push(n)}if(f.length==_he.length){break}f=[]}}return f.length!=_he.length?_bomb().length>0?_bomb():_joker():f};switch(_type()){case"single":for(var i=_me.length-1;i>=0;i--){if(_me[i]>_he[0]){return[i]}}return _bomb();case"joker":return[];case"double":return _near(1);case"same":return _near(2);case"bomb":return _near(3);case"mix":return _mix(2,_mix(1,_mix(0,0)));case"fly":var _len=_foe.replace(/(\d|t|j|q|k|a)\1{2}/g,"").length;var _num=(_foe.length-_len)/3;var _item=_fly(0,[_len,_num]);var _list=_fly(1,[_item[0],_item[1],[]]);return _fly(2,[_list,_item[1],_item[2]]);case"pair":return _pair([]);default:return _flow([])}},fight:function(_rid,_path,_token){var _plan=[],_fight=[];if($(".room-left-fight").is(":visible")||$(".room-right-fight").is(":visible")){var _prev=$(".room-left-fight").is(":visible")?"left":"right";$(".room-"+_prev+"-fight i").each(function(){_fight.push($(this).attr("class").match(/\d+/))})}$(".room-self-plan i[style*='top']").each(function(){_plan.push($(this).attr("class").match(/\d+/))});if(_plan.length>0&&this.check(_plan,_fight)){this.play(_plan.join(","),_rid,_path,_token)}else{$(".room-self-notify .room-clock").css("visibility","hidden");$(".room-rule").fadeIn("slow");setTimeout("$('.room-rule').fadeOut('fast');$('.room-self-notify .room-clock').css('visibility', '')",1e3)}},check:function(_plan,_fight){var _me=this.mold(_plan,1);var _he=this.mold(_fight,1);var _own=this.mold(_plan,0).join("");var _foe=this.mold(_fight,0).join("");var _mix=function(m){if(m.length==2){return m=="yx"?[0,0]:[1,"mix"]}else if(m.length==4){return m[0]==m[1]&&m[2]==m[3]&&m[0]!=m[2]?[1,"mix"]:[0,0]}return[0,0]};var _filter=function(f){if(f.length>0){return f.filter(function(t,i){return i<f.length-3&&t==f[i+3]})[0]}f.push(_me.filter(function(t,i){return i<_me.length-2&&t==_me[i+2]}));return[f[0],_me.filter(function(t){return f[0].indexOf(t)<0})]};var _fly=function(f){if(f[1].length<1){for(var i=0;i<f[0].length-1;i++){if(f[0][i]!=f[0][i+1]+1){if(f[0].length==4){if(i<1&&f[0][1]==f[0][3]+2||i>1&&f[0][0]<15){return[1,"fly"]}}return[0,0]}else if(i==f[0].length-2){if(f[0][0]<15||f[0].length==4){return[1,"fly"]}}}}else if(f[0].length==5&&f[1].length==1){if(f[0][0]!=f[0][1]+1&&f[0][1]==f[0][4]+3||f[0][3]!=f[0][4]+1&&f[0][0]==f[0][3]+3&&f[0][0]<15||f[0][4]>10){return[1,"fly"]}}else if(f[0].length==f[1].length||f[0].length*2==f[1].length){if(f[0].length>1){if(f[0][0]>14||f[0][0]+1!=f[0][f[0].length-1]+f[0].length){return[0,0]}}if(f[0].length==f[1].length){if(f[1].length>1&&f[1][1]>15){return[0,0]}}else if(f[1].join("").replace(/(\d+)\1{1}/g,"").length>0){return[0,0]}return[1,"fly"]}return[0,0]};var _pair=function(){if(_me.length>5&&_me.length%2<1){for(var i=1;i<_me.length/2;i++){if(_me[i*2-1]>14||_me[i*2-1]!=_me[i*2-2]||_me[i*2-1]!=_me[i*2]+1||_me[i*2]!=_me[i*2+1]){return[0,0]}}return[1,"pair"]}return[0,0]};var _flow=function(){if(_me.length>4){for(var i=0;i<_me.length-1;i++){if(_me[i]>14||_me[i]!=_me[i+1]+1){return[0,0]}}return[1,"flow"]}return[0,0]};var _alone=function(){if(_own.length<2){return[1,"single"]}else if(_own.length<3){return _own[0]!=_own[1]?_own=="yx"?[1,"joker"]:[0,0]:[1,"double"]}else if(_own.length<4){return _own[0]==_own[2]?[1,"same"]:[0,0]}else if(/(\d|t|j|q|k|a)\1{3}/.test(_own)){return _own.length<5?[1,"bomb"]:_mix(_own.replace(/(\d|t|j|q|k|a)\1{3}/,""))}else if(/(\d|t|j|q|k|a)\1{2}/.test(_own)){return _fly(_filter([]))}else if(/(\d|t|j|q|k|a)\1{1}/.test(_own)){return _pair()}return _flow()};var _triple=function(t,e){if(t.length<1){for(var i=0;i<e.length-3;i++){if((i+1)%3<1){if(e[i]!=e[i+3]-1){return[e[3],1]}else if(i==e.length-4){return[e[0],e[e.length-1]<15?0:1]}}}}else if(e.length==16&&t.length==1){return[e[4],1]}for(var i=0;i<e.length-2;i++){if(e[i]==e[i+2]){return[e[i],t.length==(e.length-t.length)/3?1:2]}}};var _battle=function(b){if(_foe=="xy"){return false}else if(_foe.length==4&&_foe[0]==_foe[3]){if(b=="joker"||b=="bomb"&&_me[0]>_he[0]){return true}}else if(b=="joker"||b=="bomb"){return true}else if(_foe.length<4){if(_me.length==_he.length&&_me[0]>_he[0]){return true}}else if(/(\d|t|j|q|k|a)\1{3}/.test(_foe)){if(b=="mix"&&_me.length==_he.length&&_filter(_me)>_filter(_he)){return true}}else if(/(\d|t|j|q|k|a)\1{2}/.test(_foe)){_own=_triple(_own.replace(/(\d|t|j|q|k|a)\1{2}/g,""),_me.reverse());_foe=_triple(_foe.replace(/(\d|t|j|q|k|a)\1{2}/g,""),_he);if(b=="fly"&&_me.length==_he.length&&_own[0]>_foe[0]&&_own[1]==_foe[1]){return true}}else if(/(\d|t|j|q|k|a)\1{1}/.test(_foe)){if(b=="pair"&&_me.length==_he.length&&_me.reverse()[0]>_he[0]){return true}}else if(b=="flow"&&_me.length==_he.length&&_me.reverse()[0]>_he[0]){return true}return false};_alone=_alone();return _alone[0]>0?_he.length>0?_battle(_alone[1]):true:false},sound:function(_type){var _src=$("body").data("path")+"client/view/index/js/"+_type+".mp3";var _set=_type=="theme"?'loop="loop"':'onended="$(this).remove()"';var _node='<audio src="'+_src+'" '+_set+' id="sound_'+_type+'" style="position:absolute;left:-9999px"></audio>';if($("#sound_"+_type).length<1){$("body").append(_node);$("#sound_"+_type)[0].play()}},clock:function(_sec,_team){this.sound("clock");$(".room-"+_team+"-notify .room-clock p").text(_sec);this.counter[_team]=_sec>0?setTimeout("lib.clock("+(_sec-1)+", '"+_team+"')",1e3):layer.msg("等待系统出牌中...")},defer:function(_fight,_team){var _new=_fight.match(/\d+/g).reverse();var _old=$(".room-"+_team+"-fight i");if(_new.length==_old.length){for(var i=0;i<_new.length;i++){if(_new[i]!=_old.eq(i).attr("class").match(/\d+/)){return true}}return false}return true},say:function(_type,_team){var _index=$(".room-talk-content p").eq(_type-1);var _class=_index.attr("class").split("-")[2];var _text=_index.text();this.sound(_class);$(".room-"+_team+"-talk p").text(_text).parent().fadeIn("slow");setTimeout("$('.room-"+_team+"-talk').fadeOut('fast')",3e3)},tool:function(_card,_count,_state){var _class="room-small-card-main room-small-card";if(_state>1){_card=_card.match(/\d+/g);_count=_count.match(/:\d/g);$(".room-top-card-main").each(function(i){$(this).text(_count[i].split(":")[1])});$(".room-top-card-one").html('<i class="'+_class+"-"+_card[0]+'"></i>').fadeIn("slow");$(".room-top-card-two").html('<i class="'+_class+"-"+_card[1]+'"></i>').fadeIn("slow");$(".room-top-card-three").html('<i class="'+_class+"-"+_card[2]+'"></i>').fadeIn("slow")}else{$(".room-top-card-main").each(function(i){$(this).text(i<2?1:4)});$(".room-top-card-one,.room-top-card-two,.room-top-card-three").html('<i class="'+_class+'-0"></i>').fadeIn("slow")}},flip:function(_card){_card=_card.match(/\d+/g);$(".room-big-card-"+_card[0]+",.room-big-card-"+_card[1]+",.room-big-card-"+_card[2]).animate({deg:360},{duration:1e3,step:function(now){$(this).css("transform","rotate("+now+"deg)")}})},cost:function(_mid,_owner){var _score=$(".room-point").data("mode")>0?_mid==_owner?$(".room-point").data("cost")*3:0:$(".room-point").data("cost");$(".room-point").data("house")<1&&layer.msg("蓝钻：-"+_score)},over:function(_last){var _score=!/\&/.test(_last)?!/\|/.test(_last)?_last:_last.split("|")[0]:_last.split("&")[0];var _array=_score.split(":");var _magic=_array[0]<2?"lose":"win";var _mark=_array[0]<2?"-"+_array[1]:"+"+_array[1];this.sound(_magic);$(".room-"+_magic).fadeIn("slow");setTimeout("$('.room-"+_magic+"').fadeOut('fast')",3e3);$(".room-point").data("house")>0&&layer.msg("金豆："+_mark);$(".room-top-card-main").html(null);$(".room-top-card-one,.room-top-card-two,.room-top-card-three").fadeOut("fast")},last:function(_data){var _first=!/\&/.test(_data["self"].last)?!/\&/.test(_data["right"].last)?"left":"right":"self";var _second=!/\|/.test(_data["self"].last)?!/\|/.test(_data["right"].last)?"left":"right":"self";var _third=/[&]|[|]/.test(_data["self"].last)?/[&]|[|]/.test(_data["right"].last)?"left":"right":"self";clearTimeout(this.counter[_first]);$(".room-"+_first+"-notify .room-clock,.room-"+_first+"-notify .room-past").fadeOut("fast");if($(".room-"+_first+"-fight").is(":hidden")||this.defer(_data[_first].last.split("&")[1],_first)){this.card(_data[_first].last.split("&")[1],"fight",_first,0)}clearTimeout(this.counter[_second]);$(".room-"+_second+"-notify .room-clock").fadeOut("fast");if(!isNaN(_data[_second].last.split("|")[1])){$(".room-"+_second+"-fight,.room-"+_second+"-notify .room-past").fadeOut("fast")}else if(_data[_second].last.split("|")[1]=="past"){if($(".room-"+_second+"-notify .room-past").is(":hidden")){$(".room-"+_second+"-fight").fadeOut("fast");this.sound("past");$(".room-"+_second+"-notify .room-past").fadeIn("slow")}}else if($(".room-"+_second+"-fight").is(":hidden")||this.defer(_data[_second].last.split("|")[1],_second)){$(".room-"+_second+"-notify .room-past").fadeOut("fast");this.card(_data[_second].last.split("|")[1],"fight",_second,0)}clearTimeout(this.counter[_third]);$(".room-"+_third+"-notify .room-clock").fadeOut("fast");if(!isNaN(_data[_third].last.split(":")[2])){$(".room-"+_third+"-fight,.room-"+_third+"-notify .room-past").fadeOut("fast")}else if(_data[_third].last.split(":")[2]=="past"){if($(".room-"+_third+"-notify .room-past").is(":hidden")){$(".room-"+_third+"-fight").fadeOut("fast");this.sound("past");$(".room-"+_third+"-notify .room-past").fadeIn("slow")}}else if($(".room-"+_third+"-fight").is(":hidden")||this.defer(_data[_third].last.split(":")[2],_third)){$(".room-"+_third+"-notify .room-past").fadeOut("fast");this.card(_data[_third].last.split(":")[2],"fight",_third,0)}this.card(_data[_first].card,"plan",_first,0);this.card(_data[_second].card,"plan",_second,0);this.card(_data[_third].card,"plan",_third,0)},mold:function(_card,_keep){if($.type(_keep)=="number"){var _convert=[];for(var i=0;i<_card.length;i++){_convert.push(this.mold(_card[i],_keep>0?true:false))}return _convert}else if($.type(_keep)=="array"){return _keep[0]?_keep[1]:_card}else if(_card<5||_card<9||_card<13){return _card<9?_card<5?3:4:5}else if(_card<17||_card<21||_card<25){return _card<21?_card<17?6:7:8}else if(_card<29||_card<33||_card<37){return _card<33?_card<29?9:this.mold("t",[_keep,10]):this.mold("j",[_keep,11])}else if(_card<41||_card<45||_card<49){return _card<45?_card<41?this.mold("q",[_keep,12]):this.mold("k",[_keep,13]):this.mold("a",[_keep,14])}return _card<54?_card<53?this.mold(2,[_keep,15]):this.mold("x",[_keep,16]):this.mold("y",[_keep,17])},bomb:function(_card){var _judge=false;if(_card.length==2&&_card[0]=="x"){_judge=true;this.sound("joker")}else if(_card.length==4&&_card[0]==_card[3]){_judge=true;this.sound("bomb")}if(_judge&&$(".room-bomb").is(":hidden")){$(".room-bomb").fadeIn("slow");setTimeout("$('.room-bomb').fadeOut('fast')",1e3)}},card:function(_text,_type,_team,_state){if(_type=="seat"){var _class="room-number-main room-number";if(_text<10){$(".room-"+_team+"-seat").html('<i class="'+_class+"-"+_text+'"></i>').fadeIn("slow")}else{var _left=$(window).width()>767?[7,29,10,30,7,33]:[2,13,3,13,3,14];var _px=_text!=11?_text!=20?[_left[0]+"px",_left[1]+"px"]:[_left[4]+"px",_left[5]+"px"]:[_left[2]+"px",_left[3]+"px"];var _html='<i class="'+_class+"-"+_text.toString()[0]+'" style="left:'+_px[0]+'"></i><i class="'+_class+"-"+_text.toString()[1]+'" style="left:'+_px[1]+'"></i>';$(".room-"+_team+"-seat").html(_html).fadeIn("slow")}}else if(_type=="fight"){var _html="";var _class="room-big-card-main room-big-card";var _left=$(window).width()>767?36:16;var _pattern=_text.match(/\d+/g).reverse();if(_team=="self"){var _width=($(window).width()-(_pattern.length+1)*_left)/2;for(var i=0;i<_pattern.length;i++){var _px=_width+i*_left;_html+='<i class="'+_class+"-"+_pattern[i]+'" style="left:'+_px+'px"></i>'}}else{for(var i=0;i<_pattern.length;i++){var _px=_team=="left"?i*_left:(_pattern.length-1-i)*_left;var _mark=_team=="left"?_px:"-"+_px;var _style=_px>0?' style="left:'+_mark+'px">':">";_html+='<i class="'+_class+"-"+_pattern[i]+'"'+_style+"</i>"}}this.sound("fight");this.bomb(this.mold(_pattern,0));$(".room-"+_team+"-fight").is(":hidden")?$(".room-"+_team+"-fight").html(_html).fadeIn("slow"):$(".room-"+_team+"-fight").html(_html).fadeOut("fast",function(){$(this).fadeIn("slow")})}else if(_type=="plan"){var _html="";var _pattern=isNaN(_text)?_text.match(/\d+/g):[];if(_team=="self"){var _class="room-big-card-main room-big-card";var _left=$(window).width()>767?36:16;var _width=($(window).width()-(_pattern.length+1)*_left)/2;if(_state>0){var _px=[];for(var i=0;i<_pattern.length;i++){_px.push(_width+i*_left);_html+='<i class="'+_class+"-"+_pattern[i]+'" style="left:'+_width+'px"></i>'}this.sound("plan");$(".room-self-plan").is(":hidden")?$(".room-self-plan").html(_html).fadeIn("slow"):$(".room-self-plan").html(_html).fadeOut("fast",function(){$(this).fadeIn("slow")});for(var i=1;i<_px.length;i++){$(".room-self-plan i").eq(i).animate({left:_px[i]+"px"},"slow")}}else if(_pattern.length>0){if($(".room-self-plan").is(":hidden")||_pattern.length!=$(".room-self-plan i").length){for(var i=0;i<_pattern.length;i++){var _px=_width+i*_left;_html+='<i class="'+_class+"-"+_pattern[i]+'" style="left:'+_px+'px"></i>'}$(".room-self-plan").is(":hidden")?$(".room-self-plan").html(_html).fadeIn("slow"):$(".room-self-plan").html(_html).fadeOut("fast",function(){$(this).fadeIn("slow")})}}else{$(".room-self-plan").fadeOut("fast")}}else if(_pattern.length>0){var _class="room-small-card-main room-small-card";var _left=$(window).width()>767?18:12;for(var i=0;i<_pattern.length;i++){var _px=_team=="left"?i*_left:(_pattern.length-1-i)*_left;var _mark=_team=="left"?_px:"-"+_px;var _style=_px>0?' style="left:'+_mark+'px">':">";_html+='<i class="'+_class+"-"+_pattern[i]+'"'+_style+"</i>"}$(".room-"+_team+"-plan").html(_html).fadeIn("slow")}}},group:function(_data){$(".room-mult p").text(_data.mult);$(".room-point p").text(_data.point);if(_data.state<1){_data["self"].state>0&&$(".room-btn-toss,.room-btn-grab,.room-btn-past,.room-btn-filter,.room-btn-fight,.room-grab,.room-toss").fadeOut("fast");_data["self"].state>0&&this.last(_data);_data["self"].state>0&&this.over(_data["self"].last);_data["self"].fight=="ready"?$(".room-btn-ready").fadeOut("fast"):$(".room-btn-ready").fadeIn("slow")}else{this.tool(_data.card,_data.count,_data.state);this.card(_data["self"].card,"plan","self",_data.state<2?_data["self"].state:0);if(_data.state<2){if(_data["self"].state>0){$(".room-btn-ready,.room-btn-toss,.room-btn-grab,.room-past,.room-right-plan,.room-left-plan,div[class*='fight']").fadeOut("fast");_data["self"].state>1?$(".room-ready").fadeOut("fast"):this.cost(_data["self"].mid,_data.owner);_data["self"].state>1&&setTimeout("$('.room-loop').fadeIn('slow')",1e3);_data["self"].state>1&&setTimeout("$('.room-loop').fadeOut('fast')",2e3);_data["self"].mid==_data.play&&setTimeout("$('.room-btn-toss,.room-btn-grab').fadeIn('slow')",_data["self"].state*1e3)}else{_data["self"].mid==_data.play?$(".room-btn-toss,.room-btn-grab").fadeIn("slow"):$(".room-btn-toss,.room-btn-grab").fadeOut("fast")}}else if(_data["self"].state>0){$(".room-btn-ready,.room-btn-toss,.room-btn-grab,.room-ready,.room-past,.room-right-plan,.room-left-plan,div[class*='fight']").fadeOut("fast");_data["self"].mid==_data.lord&&this.flip(_data.card);_data["self"].mid==_data.play&&setTimeout("$('.room-btn-past,.room-btn-filter,.room-btn-fight').fadeIn('slow')",1e3)}else{_data["self"].mid==_data.play?$(".room-btn-past,.room-btn-filter,.room-btn-fight").fadeIn("slow"):$(".room-btn-past,.room-btn-filter,.room-btn-fight").fadeOut("fast")}}},person:function(_data,_team){if(_data[_team].mid>0){if(_data.state<1){if(_data[_team].fight=="ready"){if($(".room-"+_team+"-notify .room-ready").is(":hidden")){$(".room-"+_team+"-notify .room-past").fadeOut("fast");this.sound("ready");$(".room-"+_team+"-notify .room-ready").fadeIn("slow")}}else{$(".room-"+_team+"-notify .room-ready").fadeOut("fast")}}else if(_data.state<2){if(_data["self"].state>0){if(_data["self"].state<2){if($(".room-"+_team+"-notify .room-ready").is(":hidden")){this.sound("ready");$(".room-"+_team+"-notify .room-ready").fadeIn("slow")}setTimeout("$('.room-"+_team+"-notify .room-ready').fadeOut('fast')",1e3)}else{if($(".room-"+_team+"-notify .room-toss").is(":hidden")){clearTimeout(this.counter[_team]);$(".room-"+_team+"-notify .room-clock,.room-"+_team+"-notify .room-grab").fadeOut("fast");this.sound("toss");$(".room-"+_team+"-notify .room-toss").fadeIn("slow")}setTimeout("$('.room-"+_team+"-notify .room-toss').fadeOut('fast')",1e3)}if(_data[_team].mid==_data.play){setTimeout("lib.clock("+(_data.clock-_data["self"].state)+", '"+_team+"');$('.room-"+_team+"-notify .room-clock').fadeIn('slow')",_data["self"].state*1e3)}else if(isNaN(_data[_team].fight)){setTimeout("lib.sound('"+_data[_team].fight+"');$('.room-"+_team+"-notify .room-"+_data[_team].fight+"').fadeIn('slow')",_data["self"].state*1e3)}}else if(_data[_team].mid==_data.play){if(_data.clock<1){setTimeout("lib.lord('robot', "+$("body").data("rid")+", '"+$("body").data("path")+"', '"+$("body").data("token")+"')",3e3)}else if($(".room-"+_team+"-notify .room-clock").is(":hidden")||$(".room-"+_team+"-notify .room-clock p").text()<1&&_data.clock>6){$(".room-"+_team+"-notify .room-grab,.room-"+_team+"-notify .room-toss").fadeOut("fast");this.clock(_data.clock,_team);$(".room-"+_team+"-notify .room-clock").is(":hidden")?$(".room-"+_team+"-notify .room-clock").fadeIn("slow"):$(".room-"+_team+"-notify .room-clock").fadeOut("fast",function(){$(this).fadeIn("slow")})}}else if(isNaN(_data[_team].fight)){if($(".room-"+_team+"-notify .room-"+_data[_team].fight).is(":hidden")){clearTimeout(this.counter[_team]);$(".room-"+_team+"-notify .room-clock,.room-"+_team+"-notify .room-"+(_data[_team].fight=="toss"?"grab":"toss")).fadeOut("fast");this.sound(_data[_team].fight);$(".room-"+_team+"-notify .room-"+_data[_team].fight).fadeIn("slow")}}}else{if(_data["self"].state>0){if($(".room-"+_team+"-notify .room-"+_data[_team].last).is(":hidden")){clearTimeout(this.counter[_team]);$(".room-"+_team+"-notify .room-clock,.room-"+_team+"-notify .room-"+(_data[_team].last=="toss"?"grab":"toss")).fadeOut("fast");this.sound(_data[_team].last);$(".room-"+_team+"-notify .room-"+_data[_team].last).fadeIn("slow")}setTimeout("$('.room-"+_team+"-notify .room-"+_data[_team].last+"').fadeOut('fast')",1e3);if(_data[_team].mid==_data.play){setTimeout("lib.clock("+(_data.clock-1)+", '"+_team+"');$('.room-"+_team+"-notify .room-clock').fadeIn('slow')",1e3)}else if(_data[_team].fight=="past"){setTimeout("lib.sound('past');$('.room-"+_team+"-notify .room-past').fadeIn('slow')",1e3)}else if(isNaN(_data[_team].fight)){setTimeout("lib.card('"+_data[_team].fight+"', 'fight', '"+_team+"', 0)",1e3)}}else if(_data[_team].mid==_data.play){if(_data.clock<1){setTimeout("lib.play('robot', "+$("body").data("rid")+", '"+$("body").data("path")+"', '"+$("body").data("token")+"')",3e3)}else if($(".room-"+_team+"-notify .room-clock").is(":hidden")||$(".room-"+_team+"-notify .room-clock p").text()<1&&_data.clock>6){$(".room-"+_team+"-fight,.room-"+_team+"-notify .room-past").fadeOut("fast");this.clock(_data.clock,_team);$(".room-"+_team+"-notify .room-clock").is(":hidden")?$(".room-"+_team+"-notify .room-clock").fadeIn("slow"):$(".room-"+_team+"-notify .room-clock").fadeOut("fast",function(){$(this).fadeIn("slow")})}}else if(isNaN(_data[_team].fight)){clearTimeout(this.counter[_team]);$(".room-"+_team+"-notify .room-clock").fadeOut("fast");if(_data[_team].fight=="past"){if($(".room-"+_team+"-notify .room-past").is(":hidden")){$(".room-"+_team+"-fight").fadeOut("fast");this.sound("past");$(".room-"+_team+"-notify .room-past").fadeIn("slow")}}else if($(".room-"+_team+"-fight").is(":hidden")||this.defer(_data[_team].fight,_team)){$(".room-"+_team+"-notify .room-past").fadeOut("fast");this.card(_data[_team].fight,"fight",_team,0)}}}if(_team!="self"){_data.state>0?this.card(_data[_team].number,"seat",_team,0):$(".room-"+_team+"-seat").fadeOut("fast");if(_data.state>1&&_data[_team].number<3&&$(".room-"+_team+"-warn").is(":hidden")){this.sound("warn");_data[_team].number<2&&this.sound("only");$(".room-"+_team+"-warn").fadeIn("slow")}_data.state<2&&$(".room-"+_team+"-warn").fadeOut("fast")}if($(".room-"+_team+"-info").is(":hidden")){this.sound("join");$(".room-"+_team+"-info").data("mid",_data[_team].mid);$(".room-"+_team+"-info img").attr("src",_data[_team].avatar);$(".room-"+_team+"-info .room-nick").text(_data[_team].nick);$(".room-"+_team+"-info").fadeIn("slow")}else if(_data[_team].mid!=$(".room-"+_team+"-info").data("mid")){$(".room-"+_team+"-info").data("mid",_data[_team].mid);$(".room-"+_team+"-info img").attr("src",_data[_team].avatar);$(".room-"+_team+"-info .room-nick").text(_data[_team].nick);$(".room-"+_team+"-info").fadeOut("fast",function(){$(this).fadeIn("slow")})}_data[_team].talk>0&&this.say(_data[_team].talk,_team);_data.state<1&&_data[_team].mid==_data.owner?$(".room-"+_team+"-info .room-owner").fadeIn("slow"):$(".room-"+_team+"-info .room-owner").fadeOut("fast");_data[_team].offline>0?$(".room-"+_team+"-info .room-offline").fadeIn("slow"):$(".room-"+_team+"-info .room-offline").fadeOut("fast");_data.state>1&&_data[_team].mid==_data.lord?$(".room-"+_team+"-info .room-lord").fadeIn("slow"):$(".room-"+_team+"-info .room-lord").fadeOut("fast")}else if($(".room-"+_team+"-info").is(":visible")){this.sound("out");$(".room-"+_team+"-info,.room-"+_team+"-notify .room-ready").fadeOut("fast")}},game:function(_rid,_path,_token){$.post(_path+"index.php/room/game",{rid:_rid,token:_token},function(_data){if(_data.status==1){lib.group(_data);lib.person(_data,"self");lib.person(_data,"right");lib.person(_data,"left");lib.listen=setTimeout("lib.game("+_rid+", '"+_path+"', '"+_token+"')",lib.timer)}else if(_data.status==-1){layer.msg("登录已超时！",{icon:4});setTimeout("location.href='"+_path+"'",1e3)}else if(_data.status==-2){layer.msg("您已离开房间！",{icon:5});setTimeout("location.href='"+_path+"index.php/hall'",1e3)}else if(_data.status==-3){layer.msg("您已进入其它房间！",{icon:5});setTimeout("location.reload()",1e3)}else{layer.msg(_data.status,{time:0,btn:["确定"]})}},"json").fail(function(){layer.msg("连接服务器中...",{icon:16});lib.listen=setTimeout("lib.game("+_rid+", '"+_path+"', '"+_token+"')",lib.timer)})},quit:function(_path,_token){this.load=layer.load(3);$.post(_path+"index.php/room/quit",{token:_token},function(data){layer.close(lib.load);if(data==1){layer.msg("返回成功，请稍等...",{icon:16});clearTimeout(lib.listen);setTimeout("location.href='"+_path+"index.php/hall'",1e3)}else if(data==-1){layer.msg("登录已超时！",{icon:4})}else if(data==-2){layer.msg("开局时不允许返回！",{icon:2})}else{layer.msg(data,{time:0,btn:["确定"]})}}).fail(function(){layer.close(lib.load);layer.msg("网络异常！",{shift:6})})},shift:function(_house,_rid,_path,_token){if(_house>0){this.load=layer.load(3);$.post(_path+"index.php/hall/fast",{house:_house,rid:_rid,token:_token},function(data){layer.close(lib.load);if(data==1){layer.msg("换桌成功，请稍等...",{icon:16});clearTimeout(lib.listen);setTimeout("location.reload()",1e3)}else if(data==-1){layer.msg("登录已超时！",{icon:4})}else if(data==-2){layer.msg("没有匹配到空闲房间！",{icon:5})}else if(data==-3){layer.msg("金豆余额未满足准入条件！",{icon:5})}else if(data==-4){layer.msg("请勿重复换桌！",{icon:2})}else if(data==-5){layer.msg("开局时不允许换桌！",{icon:2})}else{layer.msg(data,{time:0,btn:["确定"]})}}).fail(function(){layer.close(lib.load);layer.msg("网络异常！",{shift:6})})}else{layer.alert("蓝钻场不支持换桌！",{icon:7})}},talk:function(_type,_path,_token){this.load=layer.load(3);$.post(_path+"index.php/room/talk",{type:_type,token:_token},function(data){layer.close(lib.load);if(data==1){lib.say(_type,"self")}else if(data==-1){layer.msg("登录已超时！",{icon:4})}else{layer.msg(data,{time:0,btn:["确定"]})}}).fail(function(){layer.close(lib.load);layer.msg("网络异常！",{shift:6})})},kick:function(_confirm,_kid,_path,_token){if(_confirm<1){layer.confirm("将“"+$(".layui-layer-page .dialog-nick").next().text()+"”踢出房间？",{icon:3,btn:["确定","取消"]},function(){lib.kick(1,_kid,_path,_token)})}else{this.load=layer.load(3);$.post(_path+"index.php/room/kick",{mid:_kid,token:_token},function(data){layer.close(lib.load);if(data==1){layer.closeAll("page");layer.msg("踢出成功！",{icon:6})}else if(data==-1){layer.msg("登录已超时！",{icon:4})}else if(data==-2){layer.msg("您已离开房间！",{icon:5})}else if(data==-3){layer.msg("没有权限！",{icon:7})}else if(data==-4){layer.msg("开局时不允许踢人！",{icon:2})}else if(data==-5){layer.msg("不能踢自己！",{icon:2})}else if(data==-6){layer.msg("玩家已不在房间！",{icon:5})}else{layer.msg(data,{time:0,btn:["确定"]})}}).fail(function(){layer.close(lib.load);layer.msg("网络异常！",{shift:6})})}},score:function(_this,_house,_path,_token){this.load=layer.load(3);$.post(_path+"index.php/hall/score",{mid:_this.parent().parent().data("mid"),house:_house,token:_token},function(_data){layer.close(lib.load);if(_data.state==1){var _icon=_house>0?"pea":"gem";lib.dialog("dialog_score","玩家信息");$(".layui-layer-page .dialog-info img").attr("src",_this.attr("src"));$(".layui-layer-page .dialog-kick").data("kid",_this.parent().parent().data("mid"));$(".layui-layer-page .dialog-nick").next().text(_this.parent().next().text());$(".layui-layer-page .dialog-win").next().text(_data.win);$(".layui-layer-page .dialog-lose").next().text(_data.lose);$(".layui-layer-page .dialog-"+_icon).next().text(_data.point)}else if(_data.state==-1){layer.msg("登录已超时！",{icon:4})}else if(_data.state==-2){layer.msg("玩家不存在！",{icon:2})}else{layer.msg(_data.state,{time:0,btn:["确定"]})}},"json").fail(function(){layer.close(lib.load);layer.msg("网络异常！",{shift:6})})},help:function(_rid,_house,_mode){var _array=["初级房","中级房","高级房","大师房"];var _key=_house<1?"房间模式":"房间频道";var _val=_house<1?_mode<1?"平摊支付":"房主支付":_array[_house-1];this.dialog("dialog_help","帮助");$(".layui-layer-page .dialog-help").eq(0).html("<p>房间编号："+_rid+"</p>");$(".layui-layer-page .dialog-help").eq(1).html("<p>"+_key+"："+_val+"</p>")},order:function(_type,_start,_path,_token){this.load=layer.load(3);$.post(_path+"index.php/hall/order",{type:_type,start:_start,token:_token},function(_data){layer.close(lib.load);if(_data.state==1){var _colspan=$(".layui-layer-page .col-md-6 tbody tr:last td").attr("colspan");$(".layui-layer-page .col-md-6 tbody tr").last().remove();if(_data.total<10){$(".layui-layer-page .col-md-6 tbody").append(_data.msg+'<tr><td colspan="'+_colspan+'" style="background-color:#fff;cursor:auto">没有了</td></tr>')}else{var _now=_start+10;var _onclick="lib.order('"+_type+"', "+_now+", '"+_path+"', '"+_token+"')";$(".layui-layer-page .col-md-6 tbody").append(_data.msg+'<tr onclick="'+_onclick+'"><td colspan="'+_colspan+'">加载更多</td></tr>')}}else if(_data.state==-1){layer.msg("登录已超时！",{icon:4})}else{layer.msg(_data.state,{time:0,btn:["确定"]})}},"json").fail(function(){layer.close(lib.load);layer.msg("网络异常！",{shift:6})})},buy:function(_path,_token){var _buy_type=$(".layui-layer-page select[name='buy_type']").val();var _buy_secret=$(".layui-layer-page input[name='buy_secret']").val().replace(/^\s+|\s+$/g,"");if(!_buy_secret.match(/^[a-z0-9]{32}$/)){layer.alert("充值密钥不符合规范！",{icon:7})}else{this.load=layer.load(3);$.post(_path+"index.php/hall/buy",{buy_type:_buy_type,buy_secret:_buy_secret,token:_token},function(_data){layer.close(lib.load);var _text=_buy_type<2?"蓝钻":"金豆";if(_data.state==1){$(".room-point p").text(_data.msg);$(".layui-layer-page input[name='buy_secret']").val(null);layer.msg(_text+"充值成功！",{icon:1})}else if(_data.state==-1){layer.msg("登录已超时！",{icon:4})}else if(_data.state==-2){layer.msg("密钥无效或已使用！",{icon:5})}else{layer.msg(_data.state,{time:0,btn:["确定"]})}},"json").fail(function(){layer.close(lib.load);layer.msg("网络异常！",{shift:6})})}},page:function(_id,_title,_type,_path,_token){layer.closeAll("page");layer.open({title:_title,type:1,anim:1,shadeClose:true,area:$(window).width()<768?["90%","90%"]:["650px","650px"],content:$("#"+_id).html()});if(_type=="buy"){$(".layui-layer-page .col-md-6 thead").html("<tr><th>积分类型</th><th>积分数量</th><th>充值密钥</th><th>充值时间</th></tr>");$(".layui-layer-page .col-md-6 tbody").html("<tr onclick=\"lib.order('"+_type+"', 0, '"+_path+"', '"+_token+'\')"><td colspan="4">加载更多</td></tr>')}else if(_type=="bill"){$(".layui-layer-page .col-md-6 thead").html("<tr><th>收支方式</th><th>积分类型</th><th>积分数量</th><th>房间编号</th><th>结算时间</th></tr>");$(".layui-layer-page .col-md-6 tbody").html("<tr onclick=\"lib.order('"+_type+"', 0, '"+_path+"', '"+_token+'\')"><td colspan="5">加载更多</td></tr>')}this.order(_type,0,_path,_token)},dialog:function(_id,_title){layer.open({title:_title,type:1,anim:1,shadeClose:true,content:$("#"+_id).html()})},ready:function(_rid,_path,_token){this.load=layer.load(3);$.post(_path+"index.php/room/ready",{token:_token},function(data){layer.close(lib.load);if(data==1){clearTimeout(lib.listen);lib.game(_rid,_path,_token)}else if(data==-1){layer.msg("登录已超时！",{icon:4})}else if(data==-2){layer.msg("您已离开房间！",{icon:5})}else if(data==-3){$(".room-self-fight,.room-self-notify .room-past").css("visibility","hidden");$(".room-poor").fadeIn("slow");setTimeout("$('.room-poor').fadeOut('fast');$('.room-self-fight,.room-self-notify .room-past').css('visibility', '')",3e3)}else{layer.msg(data,{time:0,btn:["确定"]})}}).fail(function(){layer.close(lib.load);layer.msg("网络异常！",{shift:6})})},lord:function(_type,_rid,_path,_token){this.load=layer.load(3);$.post(_path+"index.php/room/lord",{type:_type,token:_token},function(data){layer.close(lib.load);if(data==1){clearTimeout(lib.listen);lib.game(_rid,_path,_token)}else if(data==-1){layer.msg("登录已超时！",{icon:4})}else if(data==-2){layer.msg("您已离开房间！",{icon:5})}else{layer.msg(data,{time:0,btn:["确定"]})}}).fail(function(){layer.close(lib.load);layer.msg("网络异常！",{shift:6})})},play:function(_type,_rid,_path,_token){this.load=layer.load(3);$.post(_path+"index.php/room/play",{type:_type,token:_token},function(data){layer.close(lib.load);if(data==1){clearTimeout(lib.listen);lib.game(_rid,_path,_token)}else if(data==-1){layer.msg("登录已超时！",{icon:4})}else if(data==-2){layer.msg("您已离开房间！",{icon:5})}else{layer.msg(data,{time:0,btn:["确定"]})}}).fail(function(){layer.close(lib.load);layer.msg("网络异常！",{shift:6})})}};$(document).ready(function(){$.ajaxSetup({timeout:lib.timer});lib.sound("theme");lib.game($("body").data("rid"),$("body").data("path"),$("body").data("token"));$(".room-btn-quit").click(function(){lib.quit($("body").data("path"),$("body").data("token"))});$(".room-btn-shift").click(function(){lib.shift($(".room-point").data("house"),$("body").data("rid"),$("body").data("path"),$("body").data("token"))});$(".room-btn-talk").click(function(){$(".room-talk-content").is(":visible")?$(".room-talk-content").fadeOut("fast"):$(".room-talk-content").fadeIn("slow")});$(".room-talk-content p").click(function(){$(this).parent().fadeOut("fast");lib.talk($(this).index()+1,$("body").data("path"),$("body").data("token"))});$(".room-btn-avatar").click(function(){lib.score($(this),$(".room-point").data("house"),$("body").data("path"),$("body").data("token"))});$(".room-btn-help").click(function(){lib.help($("body").data("rid"),$(".room-point").data("house"),$(".room-point").data("mode"))});$(".room-btn-point-buy").click(function(){lib.dialog("dialog_buy",$(".room-point").data("house")>0?"充值金豆":"充值蓝钻")});$(".room-btn-bill").click(function(){lib.page("page_order","战绩","bill",$("body").data("path"),$("body").data("token"))});$(".room-btn-ready").click(function(){lib.ready($("body").data("rid"),$("body").data("path"),$("body").data("token"))});$(".room-btn-toss,.room-btn-grab").click(function(){lib.lord(/toss/.test($(this).attr("class"))?1:0,$("body").data("rid"),$("body").data("path"),$("body").data("token"))});$(".room-self-plan").on("click","i",function(){lib.chose($(this))});$(".room-self-plan").mousedown(function(){$(this).on("mouseout","i",function(){lib.chose($(this))})}).mouseup(function(){$(this).off("mouseout")});$(".room-btn-past").click(function(){lib.past($("body").data("rid"),$("body").data("path"),$("body").data("token"))});$(".room-btn-filter").click(function(){lib.filter($(".room-self-plan i:last"))});$(".room-btn-fight").click(function(){lib.fight($("body").data("rid"),$("body").data("path"),$("body").data("token"))})});