var lib={load:0,captcha:function(){var _src=$(".layui-layer-page .captcha img").attr("src").replace(/\?.*$/,"?"+Math.random());$(".layui-layer-page .captcha img").attr("src",_src)},timer:function(_sec,_onclick){if(_sec>0){if(typeof $(".layui-layer-page .mail i").attr("onclick")!="undefined"){$(".layui-layer-page .mail i").removeAttr("onclick")}$(".layui-layer-page .mail i").text(" 等待("+_sec+")");setTimeout("lib.timer("+(_sec-1)+', "'+_onclick+'")',1e3)}else{$(".layui-layer-page .mail i").attr("onclick",_onclick).text(" 发送邮件")}},page:function(_id,_title){layer.closeAll("page");layer.open({title:_title,type:1,anim:1,shadeClose:true,content:$("#"+_id).html()});this.captcha()},sign:function(_path,_minute){var _member_name=$(".layui-layer-page input[name='member_name']").val().replace(/^\s+|\s+$/g,"");var _member_pw=$(".layui-layer-page input[name='member_pw']").val().replace(/^\s+|\s+$/g,"");var _captcha=$(".layui-layer-page input[name='captcha']").val().replace(/^\s+|\s+$/g,"");if(!_member_name.match(/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/)){layer.alert("邮箱帐号不符合规范！",{icon:7})}else if(_member_name.length>32){layer.alert("邮箱帐号最长32位！",{icon:7})}else if(/[^\x21-\x7e]|[&][#]?[a-zA-Z0-9]+[;]/.test(_member_pw)){layer.alert("登录密码不符合规范！",{icon:7})}else if(_member_pw.length<6||_member_pw.length>24){layer.alert("登录密码最短6位、最长24位！",{icon:7})}else if(/[^a-z0-9]/i.test(_captcha)||_captcha.length!=4){layer.alert("图形验证码不符合规范！",{icon:7})}else{this.load=layer.load(3);$.post(_path+"index.php/index/sign",{member_name:_member_name,member_pw:_member_pw,captcha:_captcha},function(data){layer.close(lib.load);if(data==1){layer.msg("登录成功，请稍等...",{icon:16});setTimeout("location.href='"+_path+"index.php/hall'",1e3)}else if(data==-1){layer.msg("帐号与密码不匹配！",{icon:2});lib.captcha()}else if(data==-2){layer.msg("验证码不正确！",{icon:5})}else if(data==-3){layer.msg("请"+_minute+"分钟后再尝试登录！",{icon:7})}else if(data==-4){layer.msg("帐号已被锁定！",{icon:4})}else{layer.msg(data,{time:0,btn:["确定"]})}}).fail(function(){layer.close(lib.load);layer.msg("网络异常！",{shift:6})})}},reg:function(_path,_minute){var _member_name=$(".layui-layer-page input[name='member_name']").val().replace(/^\s+|\s+$/g,"");var _member_pw=$(".layui-layer-page input[name='member_pw']").val().replace(/^\s+|\s+$/g,"");var _member_rpw=$(".layui-layer-page input[name='member_rpw']").val().replace(/^\s+|\s+$/g,"");var _captcha=$(".layui-layer-page input[name='captcha']").val().replace(/^\s+|\s+$/g,"");if(!_member_name.match(/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/)){layer.alert("邮箱帐号不符合规范！",{icon:7})}else if(_member_name.length>32){layer.alert("邮箱帐号最长32位！",{icon:7})}else if(/[^\x21-\x7e]|[&][#]?[a-zA-Z0-9]+[;]/.test(_member_pw)){layer.alert("设置密码不符合规范！",{icon:7})}else if(_member_pw.length<6||_member_pw.length>24){layer.alert("设置密码最短6位、最长24位！",{icon:7})}else if(_member_pw!=_member_rpw){layer.alert("两次输入的密码不一致！",{icon:7})}else if(/[^a-z0-9]/i.test(_captcha)||_captcha.length!=4){layer.alert("图形验证码不符合规范！",{icon:7})}else{this.load=layer.load(3);$.post(_path+"index.php/index/reg",{member_name:_member_name,member_rpw:_member_rpw,captcha:_captcha},function(data){layer.close(lib.load);if(data==1){layer.msg("注册成功，请稍等...",{icon:16});setTimeout("lib.page('page_login', '立即登录')",1e3)}else if(data==-1){layer.msg("邮箱帐号已被占用！",{icon:2})}else if(data==-2){layer.msg("验证码不正确！",{icon:5})}else if(data==-3){layer.msg("请"+_minute+"分钟后再注册帐号！",{icon:7})}else{layer.msg(data,{time:0,btn:["确定"]})}}).fail(function(){layer.close(lib.load);layer.msg("网络异常！",{shift:6})})}},lost:function(_path){var _member_name=$(".layui-layer-page input[name='member_name']").val().replace(/^\s+|\s+$/g,"");var _mail_code=$(".layui-layer-page input[name='mail_code']").val().replace(/^\s+|\s+$/g,"");var _member_pw=$(".layui-layer-page input[name='member_pw']").val().replace(/^\s+|\s+$/g,"");var _member_rpw=$(".layui-layer-page input[name='member_rpw']").val().replace(/^\s+|\s+$/g,"");var _captcha=$(".layui-layer-page input[name='captcha']").val().replace(/^\s+|\s+$/g,"");if(!_member_name.match(/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/)){layer.alert("邮箱帐号不符合规范！",{icon:7})}else if(_member_name.length>32){layer.alert("邮箱帐号最长32位！",{icon:7})}else if(!_mail_code.match(/^[a-z0-9]{32}$/)){layer.alert("邮件凭证码不符合规范！",{icon:7})}else if(/[^\x21-\x7e]|[&][#]?[a-zA-Z0-9]+[;]/.test(_member_pw)){layer.alert("重设密码不符合规范！",{icon:7})}else if(_member_pw.length<6||_member_pw.length>24){layer.alert("重设密码最短6位、最长24位！",{icon:7})}else if(_member_pw!=_member_rpw){layer.alert("两次输入的密码不一致！",{icon:7})}else if(/[^a-z0-9]/i.test(_captcha)||_captcha.length!=4){layer.alert("图形验证码不符合规范！",{icon:7})}else{this.load=layer.load(3);$.post(_path+"index.php/index/lost",{member_name:_member_name,mail_code:_mail_code,member_rpw:_member_rpw,captcha:_captcha},function(data){layer.close(lib.load);if(data==1){layer.msg("重置成功，请稍等...",{icon:16});setTimeout("lib.page('page_login', '立即登录')",1e3)}else if(data==-1){layer.msg("凭证码无效或已过期！",{icon:5})}else if(data==-2){layer.msg("验证码不正确！",{icon:5})}else if(data==-3){layer.msg("邮箱帐号不存在！",{icon:2})}else{layer.msg(data,{time:0,btn:["确定"]})}}).fail(function(){layer.close(lib.load);layer.msg("网络异常！",{shift:6})})}},mail_send:function(_path,_minute){var _member_name=$(".layui-layer-page input[name='member_name']").val().replace(/^\s+|\s+$/g,"");if(!_member_name.match(/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/)){layer.alert("邮箱帐号不符合规范！",{icon:7})}else if(_member_name.length>32){layer.alert("邮箱帐号最长32位！",{icon:7})}else{this.load=layer.load(3);$.post(_path+"index.php/index/send",{member_name:_member_name},function(data){layer.close(lib.load);if(data==1){layer.msg("凭证码已发送至邮箱！",{icon:1});lib.timer(60,$(".layui-layer-page .mail i").attr("onclick"))}else if(data==-1){layer.msg("邮件功能暂未开启！",{icon:5})}else if(data==-2){layer.msg("邮箱帐号不存在！",{icon:2})}else if(data==-3){layer.msg("请"+_minute+"分钟后再发送邮件！",{icon:7})}else{layer.msg(data,{time:0,btn:["确定"]})}}).fail(function(){layer.close(lib.load);layer.msg("网络异常！",{shift:6})})}}};